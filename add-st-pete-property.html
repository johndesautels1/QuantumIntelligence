<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add St Pete Beach Property</title>
    <script src="core/data-manager.js"></script>
    <script src="shared-data-adapter.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: #0a1628;
            color: white;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
        }
        .container {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 30px;
        }
        button {
            background: linear-gradient(135deg, #0066CC, #00D4FF);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            margin: 20px 0;
            width: 100%;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 212, 255, 0.4);
        }
        .result {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        pre {
            background: rgba(0,0,0,0.5);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèñÔ∏è Add St Pete Beach Property to Database</h1>
        <p>This will add the property at <strong>280 41st Ave, Saint Pete Beach, FL 33706</strong> to IndexedDB for testing the FEMA flood zone API.</p>

        <pre>
Street: 280 41st Ave
City: Saint Pete Beach
State: FL
ZIP: 33706
Price: $750,000
Bedrooms: 4
Bathrooms: 3
Living Area: 1,729 sqft
Lot Size: 7,200 sqft
Year Built: 1953
Type: Single Family
MLS: TB8443855
Coordinates: 27.7320, -82.7430
        </pre>

        <button onclick="addProperty()">Add Property to Database</button>

        <div id="result" class="result" style="display:none;"></div>
    </div>

    <script>
        async function addProperty() {
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'Initializing database...\n';

            try {
                // Initialize data manager
                await sharedDataAdapter.init();
                resultDiv.innerHTML += '‚úÖ Database initialized\n\n';

                // Create property object in the correct format
                const newProperty = {
                    id: "prop_st_pete_beach_test",
                    source: "manual_import",
                    importDate: new Date().toISOString(),
                    basic: {
                        address: "280 41st Ave",
                        bedrooms: 4,
                        bathrooms: 3,
                        squareFeet: 1729,
                        lotSize: 7200,
                        yearBuilt: 1953,
                        propertyType: "Single Family",
                        description: "FEMA flood zone test property - St Pete Beach coastal location",
                        mlsNumber: "TB8443855"
                    },
                    financial: {
                        listingPrice: 750000,
                        daysOnMarket: 0,
                        hoaFees: 0,
                        annualTaxes: 0,
                        pricePerSqFt: Math.round(750000 / 1729)
                    },
                    location: {
                        city: "Saint Pete Beach",
                        state: "FL",
                        zipCode: "33706",
                        latitude: 27.7320,
                        longitude: -82.7430,
                        neighborhood: "St Pete Beach",
                        county: "Pinellas"
                    },
                    features: {
                        parking: "Unknown",
                        cooling: "Unknown",
                        heating: "Unknown",
                        fireplace: false,
                        pool: false,
                        stories: 1,
                        basement: false,
                        garage: 0
                    },
                    condition: {
                        overall: "Unknown",
                        roof: "Unknown",
                        foundation: "Unknown",
                        lastRenovated: null
                    },
                    computed_scores: {
                        overall_score: 75,
                        by_category: {
                            location: { score: 85 },
                            financial: { score: 70 },
                            property_physical: { score: 70 }
                        }
                    }
                };

                resultDiv.innerHTML += 'Adding property to database...\n';

                // Add property using data manager
                const db = await sharedDataAdapter.db;
                const tx = db.transaction('properties', 'readwrite');
                const store = tx.objectStore('properties');

                // Check if property already exists
                const existing = await store.get(newProperty.id);
                if (existing) {
                    resultDiv.innerHTML += '<span class="error">‚ö†Ô∏è Property already exists, updating...</span>\n';
                }

                await store.put(newProperty);
                await tx.done;

                resultDiv.innerHTML += '<span class="success">‚úÖ Property added successfully!</span>\n\n';
                resultDiv.innerHTML += 'Property Details:\n';
                resultDiv.innerHTML += JSON.stringify(newProperty, null, 2);
                resultDiv.innerHTML += '\n\n<span class="success">You can now test this property in the Weather Simulator!</span>\n';
                resultDiv.innerHTML += '\nExpected FEMA Flood Zone: AE or VE (St Pete Beach is coastal high-risk area)';

            } catch (error) {
                resultDiv.innerHTML += '<span class="error">‚ùå ERROR:</span>\n';
                resultDiv.innerHTML += error.message + '\n';
                resultDiv.innerHTML += error.stack;
            }
        }
    </script>
</body>
</html>
