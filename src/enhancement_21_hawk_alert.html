<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhancement #21: Hawk Alert‚Ñ¢ Real-Time Threat Detection | CLUES‚Ñ¢</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0f0f 50%, #1f0a0a 100%);
            color: #e0e0e0;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 0, 0, 0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 0, 0, 0.2);
        }

        h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, #ff006e, #ff4500, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #a0a0a0;
            font-size: 1.1em;
        }

        .status-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .pulse {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00ff00;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 10px #00ff00; }
            50% { opacity: 0.5; box-shadow: 0 0 20px #00ff00; }
        }

        .pulse.warning {
            background: #ff9e00;
            animation-name: pulseWarning;
        }

        @keyframes pulseWarning {
            0%, 100% { opacity: 1; box-shadow: 0 0 10px #ff9e00; }
            50% { opacity: 0.5; box-shadow: 0 0 20px #ff9e00; }
        }

        .pulse.critical {
            background: #ff006e;
            animation-name: pulseCritical;
        }

        @keyframes pulseCritical {
            0%, 100% { opacity: 1; box-shadow: 0 0 10px #ff006e; }
            50% { opacity: 0.5; box-shadow: 0 0 20px #ff006e; }
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            max-width: 1800px;
            margin: 0 auto;
        }

        .panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .panel:hover {
            border-color: rgba(255, 0, 110, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(255, 0, 110, 0.2);
        }

        .panel-header {
            font-size: 1.3em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #ff4500;
        }

        .alert-feed {
            max-height: 600px;
            overflow-y: auto;
        }

        .alert-feed::-webkit-scrollbar {
            width: 8px;
        }

        .alert-feed::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        .alert-feed::-webkit-scrollbar-thumb {
            background: rgba(255, 0, 110, 0.5);
            border-radius: 4px;
        }

        .alert-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 12px;
            border-left: 4px solid;
            transition: all 0.3s ease;
            cursor: pointer;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .alert-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(5px);
        }

        .alert-item.critical {
            border-left-color: #ff006e;
            background: rgba(255, 0, 110, 0.1);
        }

        .alert-item.warning {
            border-left-color: #ff9e00;
            background: rgba(255, 158, 0, 0.1);
        }

        .alert-item.info {
            border-left-color: #00d4ff;
            background: rgba(0, 212, 255, 0.1);
        }

        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .alert-title {
            font-weight: 600;
            font-size: 1.05em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .alert-time {
            font-size: 0.85em;
            color: #a0a0a0;
        }

        .alert-body {
            color: #c0c0c0;
            font-size: 0.95em;
            margin-bottom: 8px;
        }

        .alert-meta {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            font-size: 0.85em;
            color: #a0a0a0;
        }

        .badge {
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge.critical {
            background: rgba(255, 0, 110, 0.2);
            color: #ff006e;
        }

        .badge.warning {
            background: rgba(255, 158, 0, 0.2);
            color: #ff9e00;
        }

        .badge.info {
            background: rgba(0, 212, 255, 0.2);
            color: #00d4ff;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #ff006e, #cc0055);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 0, 110, 0.4);
        }

        button.secondary {
            background: linear-gradient(135deg, #ff9e00, #cc7d00);
        }

        button.success {
            background: linear-gradient(135deg, #00ff88, #00cc6b);
        }

        .monitor-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .monitor-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .monitor-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: scale(1.05);
        }

        .monitor-value {
            font-size: 2em;
            font-weight: 700;
            background: linear-gradient(135deg, #ff006e, #ff9e00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .monitor-label {
            color: #a0a0a0;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .threshold-input {
            display: flex;
            gap: 10px;
            align-items: center;
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        input[type="number"], input[type="text"] {
            flex: 1;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: #e0e0e0;
            font-size: 0.95em;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .red-flag-item {
            background: rgba(255, 0, 0, 0.1);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 3px solid #ff006e;
        }

        .red-flag-title {
            font-weight: 600;
            color: #ff006e;
            margin-bottom: 5px;
        }

        .red-flag-description {
            font-size: 0.9em;
            color: #c0c0c0;
        }

        .incident-map {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
            min-height: 200px;
        }

        .incident-marker {
            display: inline-block;
            padding: 8px 12px;
            background: rgba(255, 0, 110, 0.2);
            border-radius: 6px;
            margin: 5px;
            font-size: 0.9em;
        }

        .financial-warning {
            background: rgba(255, 158, 0, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 12px;
            border-left: 4px solid #ff9e00;
        }

        .warning-title {
            font-weight: 600;
            color: #ff9e00;
            margin-bottom: 8px;
        }

        .warning-details {
            font-size: 0.9em;
            color: #c0c0c0;
        }

        .stat-bar {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 1.8em;
            font-weight: 700;
            color: #ff4500;
        }

        .stat-text {
            font-size: 0.85em;
            color: #a0a0a0;
            margin-top: 3px;
        }

        .toggle {
            position: relative;
            width: 50px;
            height: 26px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 13px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle.active {
            background: linear-gradient(135deg, #00ff88, #00cc6b);
        }

        .toggle-knob {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .toggle.active .toggle-knob {
            transform: translateX(24px);
        }

        .monitor-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ü¶Ö Hawk Alert‚Ñ¢ Real-Time Threat Detection</h1>
        <div class="subtitle">Lightning-Fast Market Intelligence & Risk Monitoring</div>
    </div>

    <div class="status-bar">
        <div class="status-indicator">
            <div class="pulse" id="systemPulse"></div>
            <span id="systemStatus">System Active</span>
        </div>
        <div class="status-indicator">
            <span>‚ö° Response Time: <strong id="responseTime">< 5 min</strong></span>
        </div>
        <div class="status-indicator">
            <span>üì° Monitoring: <strong id="monitoringCount">247 Properties</strong></span>
        </div>
        <div class="status-indicator">
            <span>üö® Active Alerts: <strong id="activeAlerts">0</strong></span>
        </div>
    </div>

    <div class="dashboard">
        <!-- Real-Time Alert Feed -->
        <div class="panel" style="grid-column: span 2;">
            <div class="panel-header">
                üî¥ Live Alert Feed
            </div>
            <div class="controls">
                <button onclick="startMonitoring()">‚ñ∂Ô∏è Start Monitoring</button>
                <button class="secondary" onclick="pauseMonitoring()">‚è∏Ô∏è Pause</button>
                <button class="success" onclick="simulateAlert()">‚ö° Simulate Alert</button>
                <button onclick="clearAlerts()" style="background: linear-gradient(135deg, #666, #444);">üóëÔ∏è Clear All</button>
            </div>
            <div class="alert-feed" id="alertFeed"></div>
        </div>

        <!-- Price Drop Alerts -->
        <div class="panel">
            <div class="panel-header">
                üí∞ Price Drop Monitor
            </div>
            <div class="threshold-input">
                <span>Alert threshold:</span>
                <input type="number" id="priceDropThreshold" value="5" min="1" max="50">
                <span>%</span>
            </div>
            <div class="monitor-grid">
                <div class="monitor-card">
                    <div class="monitor-value" id="priceDropCount">0</div>
                    <div class="monitor-label">Today</div>
                </div>
                <div class="monitor-card">
                    <div class="monitor-value" id="avgPriceDrop">0%</div>
                    <div class="monitor-label">Avg Drop</div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="priceDropChart"></canvas>
            </div>
        </div>

        <!-- New Listing Monitor -->
        <div class="panel">
            <div class="panel-header">
                üè† New Listing Monitor
            </div>
            <div class="threshold-input">
                <span>Match criteria:</span>
                <input type="text" id="listingCriteria" value="Downtown, 3+ beds" placeholder="Enter criteria">
            </div>
            <div class="monitor-grid">
                <div class="monitor-card">
                    <div class="monitor-value" id="newListingCount">0</div>
                    <div class="monitor-label">New Today</div>
                </div>
                <div class="monitor-card">
                    <div class="monitor-value" id="matchedListings">0</div>
                    <div class="monitor-label">Matched</div>
                </div>
            </div>
            <div id="newListingsList" style="margin-top: 15px;"></div>
        </div>

        <!-- Status Change Monitor -->
        <div class="panel">
            <div class="panel-header">
                üîÑ Status Change Monitor
            </div>
            <div style="margin-bottom: 15px;">
                <div class="monitor-toggle">
                    <span>Pending ‚Üí Active</span>
                    <div class="toggle active" onclick="toggleMonitor(this)"><div class="toggle-knob"></div></div>
                </div>
                <div class="monitor-toggle">
                    <span>Active ‚Üí Contingent</span>
                    <div class="toggle active" onclick="toggleMonitor(this)"><div class="toggle-knob"></div></div>
                </div>
                <div class="monitor-toggle">
                    <span>Contingent ‚Üí Closed</span>
                    <div class="toggle active" onclick="toggleMonitor(this)"><div class="toggle-knob"></div></div>
                </div>
                <div class="monitor-toggle">
                    <span>Back on Market</span>
                    <div class="toggle active" onclick="toggleMonitor(this)"><div class="toggle-knob"></div></div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="statusChart"></canvas>
            </div>
        </div>

        <!-- Competitive Bid Alerts -->
        <div class="panel">
            <div class="panel-header">
                ‚öîÔ∏è Competitive Bid Alerts
            </div>
            <div class="monitor-grid">
                <div class="monitor-card">
                    <div class="monitor-value" id="competitiveBids">0</div>
                    <div class="monitor-label">Active Wars</div>
                </div>
                <div class="monitor-card">
                    <div class="monitor-value" id="avgBidders">0</div>
                    <div class="monitor-label">Avg Bidders</div>
                </div>
            </div>
            <div id="competitiveBidsList" style="margin-top: 15px;"></div>
        </div>

        <!-- Inspection Red Flags -->
        <div class="panel">
            <div class="panel-header">
                üö© Inspection Red Flag Database
            </div>
            <div id="redFlagsList"></div>
        </div>

        <!-- Neighborhood Incidents -->
        <div class="panel">
            <div class="panel-header">
                üìç Neighborhood Incident Alerts
            </div>
            <div class="threshold-input">
                <span>Radius:</span>
                <input type="number" id="incidentRadius" value="1" min="0.5" max="10" step="0.5">
                <span>miles</span>
            </div>
            <div class="incident-map" id="incidentMap">
                <div style="color: #a0a0a0; text-align: center; padding: 20px;">
                    Monitoring incidents within radius...
                </div>
            </div>
            <div class="stat-bar">
                <div class="stat-item">
                    <div class="stat-number" id="crimeIncidents">0</div>
                    <div class="stat-text">Crime Reports</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="constructionIncidents">0</div>
                    <div class="stat-text">Construction</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="otherIncidents">0</div>
                    <div class="stat-text">Other</div>
                </div>
            </div>
        </div>

        <!-- Financial Trigger Warnings -->
        <div class="panel">
            <div class="panel-header">
                üí≥ Financial Trigger Warnings
            </div>
            <div id="financialWarningsList"></div>
        </div>

        <!-- Analytics Overview -->
        <div class="panel" style="grid-column: span 2;">
            <div class="panel-header">
                üìä Threat Analytics Overview
            </div>
            <div class="chart-container">
                <canvas id="threatChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // Global State
        let isMonitoring = false;
        let monitoringInterval = null;
        let alerts = [];
        let charts = {};

        // Alert Types
        const ALERT_TYPES = {
            PRICE_DROP: { icon: 'üí∞', severity: 'critical' },
            NEW_LISTING: { icon: 'üè†', severity: 'warning' },
            STATUS_CHANGE: { icon: 'üîÑ', severity: 'info' },
            COMPETITIVE_BID: { icon: '‚öîÔ∏è', severity: 'critical' },
            RED_FLAG: { icon: 'üö©', severity: 'warning' },
            INCIDENT: { icon: 'üìç', severity: 'warning' },
            FINANCIAL: { icon: 'üí≥', severity: 'critical' }
        };

        // Statistics
        let stats = {
            priceDrops: 0,
            newListings: 0,
            statusChanges: 0,
            competitiveBids: 0,
            redFlags: 0,
            incidents: { crime: 0, construction: 0, other: 0 },
            financialWarnings: 0
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadFromStorage();
            initializeCharts();
            populateRedFlags();
            populateFinancialWarnings();
            updateDashboard();
        });

        function loadFromStorage() {
            const saved = localStorage.getItem('hawkAlert');
            if (saved) {
                const data = JSON.parse(saved);
                alerts = data.alerts || [];
                stats = data.stats || stats;
            }
        }

        function saveToStorage() {
            localStorage.setItem('hawkAlert', JSON.stringify({
                alerts: alerts,
                stats: stats
            }));
        }

        function startMonitoring() {
            if (isMonitoring) return;

            isMonitoring = true;
            document.getElementById('systemStatus').textContent = 'Monitoring Active';
            document.getElementById('systemPulse').className = 'pulse';

            // Simulate real-time monitoring (in production, this would be WebSocket)
            monitoringInterval = setInterval(() => {
                // Random chance to generate alerts
                if (Math.random() > 0.7) {
                    generateRandomAlert();
                }
            }, 5000); // Check every 5 seconds

            addAlert({
                type: 'STATUS_CHANGE',
                title: 'Monitoring Started',
                message: 'Hawk Alert‚Ñ¢ is now monitoring 247 properties in real-time',
                severity: 'info'
            });
        }

        function pauseMonitoring() {
            if (!isMonitoring) return;

            isMonitoring = false;
            document.getElementById('systemStatus').textContent = 'Monitoring Paused';
            document.getElementById('systemPulse').className = 'pulse warning';

            if (monitoringInterval) {
                clearInterval(monitoringInterval);
                monitoringInterval = null;
            }

            addAlert({
                type: 'STATUS_CHANGE',
                title: 'Monitoring Paused',
                message: 'Real-time monitoring temporarily suspended',
                severity: 'warning'
            });
        }

        function generateRandomAlert() {
            const alertTypes = [
                {
                    type: 'PRICE_DROP',
                    generator: () => {
                        const drop = Math.floor(Math.random() * 15) + 3;
                        const address = `${Math.floor(Math.random() * 999)} ${['Oak', 'Maple', 'Pine', 'Elm', 'Cedar'][Math.floor(Math.random() * 5)]} St`;
                        const oldPrice = 500000 + Math.floor(Math.random() * 500000);
                        const newPrice = Math.floor(oldPrice * (1 - drop / 100));
                        stats.priceDrops++;
                        return {
                            title: `Price Drop Alert: -${drop}%`,
                            message: `${address} reduced from $${(oldPrice/1000).toFixed(0)}K to $${(newPrice/1000).toFixed(0)}K`,
                            property: address
                        };
                    }
                },
                {
                    type: 'NEW_LISTING',
                    generator: () => {
                        const address = `${Math.floor(Math.random() * 999)} ${['Broadway', 'Main', 'Park', 'Lake', 'River'][Math.floor(Math.random() * 5)]} Ave`;
                        stats.newListings++;
                        return {
                            title: 'New Listing Match',
                            message: `${address} - 3bd/2ba, ${Math.floor(Math.random() * 2000) + 1500}sqft, $${Math.floor(Math.random() * 500) + 300}K`,
                            property: address
                        };
                    }
                },
                {
                    type: 'COMPETITIVE_BID',
                    generator: () => {
                        const address = `${Math.floor(Math.random() * 999)} ${['Valley', 'Hill', 'Garden', 'Forest'][Math.floor(Math.random() * 4)]} Rd`;
                        const bidders = Math.floor(Math.random() * 8) + 2;
                        stats.competitiveBids++;
                        return {
                            title: 'Bidding War Alert',
                            message: `${address} now has ${bidders} competing offers, highest bid $${Math.floor(Math.random() * 100) + 500}K`,
                            property: address
                        };
                    }
                },
                {
                    type: 'STATUS_CHANGE',
                    generator: () => {
                        const address = `${Math.floor(Math.random() * 999)} ${['Sunset', 'Mountain', 'Beach'][Math.floor(Math.random() * 3)]} Blvd`;
                        const changes = ['Pending ‚Üí Active', 'Active ‚Üí Contingent', 'Contingent ‚Üí Closed', 'Back on Market'];
                        const change = changes[Math.floor(Math.random() * changes.length)];
                        stats.statusChanges++;
                        return {
                            title: 'Status Change Detected',
                            message: `${address} - ${change}`,
                            property: address
                        };
                    }
                }
            ];

            const alertType = alertTypes[Math.floor(Math.random() * alertTypes.length)];
            const alertData = alertType.generator();

            addAlert({
                type: alertType.type,
                ...alertData,
                severity: ALERT_TYPES[alertType.type].severity
            });
        }

        function simulateAlert() {
            generateRandomAlert();
        }

        function addAlert(data) {
            const alert = {
                id: Date.now() + Math.random(),
                timestamp: Date.now(),
                type: data.type,
                title: data.title,
                message: data.message,
                property: data.property || null,
                severity: data.severity,
                read: false
            };

            alerts.unshift(alert);

            // Keep only last 100 alerts
            if (alerts.length > 100) {
                alerts = alerts.slice(0, 100);
            }

            saveToStorage();
            updateDashboard();

            // Play notification sound (in production)
            if (alert.severity === 'critical') {
                document.getElementById('systemPulse').className = 'pulse critical';
                setTimeout(() => {
                    document.getElementById('systemPulse').className = isMonitoring ? 'pulse' : 'pulse warning';
                }, 3000);
            }
        }

        function clearAlerts() {
            if (confirm('Clear all alerts from the feed?')) {
                alerts = [];
                saveToStorage();
                updateDashboard();
            }
        }

        function renderAlertFeed() {
            const feed = document.getElementById('alertFeed');

            if (alerts.length === 0) {
                feed.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #a0a0a0;">
                        <div style="font-size: 3em; margin-bottom: 15px;">üì≠</div>
                        <div>No alerts yet. Click "Start Monitoring" to begin.</div>
                    </div>
                `;
                return;
            }

            feed.innerHTML = alerts.map(alert => {
                const alertType = ALERT_TYPES[alert.type];
                const timeAgo = getTimeAgo(alert.timestamp);

                return `
                    <div class="alert-item ${alert.severity}" onclick="markAlertRead(${alert.id})">
                        <div class="alert-header">
                            <div class="alert-title">
                                <span>${alertType.icon}</span>
                                <span>${alert.title}</span>
                            </div>
                            <div class="alert-time">${timeAgo}</div>
                        </div>
                        <div class="alert-body">${alert.message}</div>
                        <div class="alert-meta">
                            <span class="badge ${alert.severity}">${alert.severity}</span>
                            ${alert.property ? `<span>üè† ${alert.property}</span>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function markAlertRead(id) {
            const alert = alerts.find(a => a.id === id);
            if (alert) {
                alert.read = true;
                saveToStorage();
            }
        }

        function getTimeAgo(timestamp) {
            const seconds = Math.floor((Date.now() - timestamp) / 1000);

            if (seconds < 60) return `${seconds}s ago`;
            if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
            return `${Math.floor(seconds / 86400)}d ago`;
        }

        function populateRedFlags() {
            const redFlags = [
                {
                    title: 'Foundation Issues',
                    description: 'Cracks in foundation, settling indicators, water damage in basement'
                },
                {
                    title: 'Roof Age > 20 Years',
                    description: 'Missing shingles, sagging roof line, water stains in attic'
                },
                {
                    title: 'Electrical Hazards',
                    description: 'Outdated wiring, aluminum wiring, insufficient amperage'
                },
                {
                    title: 'Mold & Water Damage',
                    description: 'Musty odors, water stains, visible mold growth'
                },
                {
                    title: 'HVAC System Failure',
                    description: 'System age > 15 years, inadequate heating/cooling'
                },
                {
                    title: 'Structural Damage',
                    description: 'Uneven floors, cracked walls, door alignment issues'
                }
            ];

            document.getElementById('redFlagsList').innerHTML = redFlags.map(flag => `
                <div class="red-flag-item">
                    <div class="red-flag-title">üö© ${flag.title}</div>
                    <div class="red-flag-description">${flag.description}</div>
                </div>
            `).join('');
        }

        function populateFinancialWarnings() {
            const warnings = [
                {
                    title: 'Interest Rate Spike',
                    details: '30-year fixed rates increased 0.5% this week. Your buying power decreased by ~8%.',
                    impact: 'high'
                },
                {
                    title: 'Appraisal Gap Risk',
                    details: 'Market overheating. 35% of recent sales appraised below offer price.',
                    impact: 'medium'
                },
                {
                    title: 'Property Tax Increase',
                    details: 'County reassessment scheduled. Expect 10-15% increase in target areas.',
                    impact: 'medium'
                },
                {
                    title: 'HOA Fees Rising',
                    details: 'Special assessment proposed for community repairs ($5,000 per unit).',
                    impact: 'high'
                }
            ];

            document.getElementById('financialWarningsList').innerHTML = warnings.map(warning => `
                <div class="financial-warning">
                    <div class="warning-title">üí≥ ${warning.title}</div>
                    <div class="warning-details">${warning.details}</div>
                </div>
            `).join('');
        }

        function toggleMonitor(element) {
            element.classList.toggle('active');
        }

        function updateDashboard() {
            renderAlertFeed();
            updateStats();
            updateCharts();
        }

        function updateStats() {
            document.getElementById('activeAlerts').textContent = alerts.filter(a => !a.read).length;
            document.getElementById('priceDropCount').textContent = stats.priceDrops;
            document.getElementById('avgPriceDrop').textContent = stats.priceDrops > 0 ? '7.2%' : '0%';
            document.getElementById('newListingCount').textContent = stats.newListings;
            document.getElementById('matchedListings').textContent = Math.floor(stats.newListings * 0.6);
            document.getElementById('competitiveBids').textContent = stats.competitiveBids;
            document.getElementById('avgBidders').textContent = stats.competitiveBids > 0 ? Math.floor(Math.random() * 3) + 3 : '0';
            document.getElementById('crimeIncidents').textContent = stats.incidents.crime;
            document.getElementById('constructionIncidents').textContent = stats.incidents.construction;
            document.getElementById('otherIncidents').textContent = stats.incidents.other;
        }

        function initializeCharts() {
            // Price Drop Trend Chart
            const priceDropCtx = document.getElementById('priceDropChart').getContext('2d');
            charts.priceDrop = new Chart(priceDropCtx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Price Drops',
                        data: [2, 5, 3, 8, 6, 4, 7],
                        borderColor: '#ff006e',
                        backgroundColor: 'rgba(255, 0, 110, 0.2)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#a0a0a0' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            ticks: { color: '#a0a0a0' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: { color: '#e0e0e0' }
                        }
                    }
                }
            });

            // Status Change Chart
            const statusCtx = document.getElementById('statusChart').getContext('2d');
            charts.status = new Chart(statusCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Pending‚ÜíActive', 'Active‚ÜíContingent', 'Contingent‚ÜíClosed', 'Back on Market'],
                    datasets: [{
                        data: [12, 18, 25, 5],
                        backgroundColor: [
                            'rgba(0, 212, 255, 0.7)',
                            'rgba(255, 158, 0, 0.7)',
                            'rgba(0, 255, 136, 0.7)',
                            'rgba(255, 0, 110, 0.7)'
                        ],
                        borderColor: [
                            '#00d4ff',
                            '#ff9e00',
                            '#00ff88',
                            '#ff006e'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#e0e0e0' }
                        }
                    }
                }
            });

            // Threat Analytics Chart
            const threatCtx = document.getElementById('threatChart').getContext('2d');
            charts.threat = new Chart(threatCtx, {
                type: 'bar',
                data: {
                    labels: ['Price Drops', 'New Listings', 'Status Changes', 'Competitive Bids', 'Red Flags', 'Incidents', 'Financial'],
                    datasets: [{
                        label: 'Alert Count',
                        data: [0, 0, 0, 0, 6, 3, 4],
                        backgroundColor: 'rgba(255, 69, 0, 0.7)',
                        borderColor: '#ff4500',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#a0a0a0' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            ticks: { color: '#a0a0a0' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: { color: '#e0e0e0' }
                        }
                    }
                }
            });
        }

        function updateCharts() {
            // Update threat analytics with current stats
            charts.threat.data.datasets[0].data = [
                stats.priceDrops,
                stats.newListings,
                stats.statusChanges,
                stats.competitiveBids,
                6, // Red flags (static)
                stats.incidents.crime + stats.incidents.construction + stats.incidents.other,
                4 // Financial warnings (static)
            ];
            charts.threat.update();

            // Update price drop trend (simulate real-time data)
            if (stats.priceDrops > 0) {
                const lastIndex = charts.priceDrop.data.datasets[0].data.length - 1;
                charts.priceDrop.data.datasets[0].data[lastIndex] = stats.priceDrops;
                charts.priceDrop.update();
            }
        }

        // Simulate some incidents
        setTimeout(() => {
            stats.incidents.crime = Math.floor(Math.random() * 3);
            stats.incidents.construction = Math.floor(Math.random() * 5) + 2;
            stats.incidents.other = Math.floor(Math.random() * 4);
            updateDashboard();
        }, 1000);
    </script>
</body>
</html>
